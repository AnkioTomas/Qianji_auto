<html>
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
          name="viewport">
    <meta content="ie=edge" http-equiv="X-UA-Compatible">
    <title>文本识别规则编辑</title>
    <link href="../Public/css/regular22.css" rel="stylesheet">
    <link href="../Public/css/regulars.min.css" rel="stylesheet">
    <link href="../Public/css/tip.min.css" rel="stylesheet">
</head>
<body>
<div class="rule">
    <form action="" onsubmit="return false">
        <div class="sort_name"><label for="sort_name">规则名称</label>
            <div class="rule_content">
                <div class="rule_content1 sort_rule_remark"><input id="sort_name"
                                                                   placeholder="分类规则名称" type="text"
                                                                   value="未命名"></div>
            </div>
        </div>
        <div class="sort_remark"><label for="sort_remark">规则说明</label>
            <div class="rule_content">
                <div class="rule_content1 textarea"> <textarea cols="30" id="sort_remark"
                                                               name="sort_remark"
                                                               placeholder="请输入说明..."
                                                               rows="5"></textarea></div>
            </div>
        </div>
        <div class="sort_package"><label for="sort_package">适用app包名</label>
            <div class="rule_content">
                <div class="rule_content1 sort_package1"><input id="sort_package"
                                                                placeholder="如：cn.ankio.net"
                                                                type="text"></div>
            </div>
        </div>
        <div class="sort_remark"><label>正则测试</label></div>
        <div class="main " style="background-color: #fff">
            <div class="inner">
                <div id="preset_regex"><h4>常用正则：</h4>
                    <ul class="clearfix">
                        <li><a data-regex="\d+(\.\d+)?" href="#">匹配浮点数（常用于金额）</a></li>
                        <li><a data-regex="[\u4e00-\u9fa5]+" href="#">匹配中文</a></li>
                        <li><a data-regex="[\s\S]*" href="#">匹配任意字符</a></li>
                        <li><a data-regex=".*" href="#">匹配任意不换行字符</a></li>
                    </ul>
                </div>
                <h4>正则表达式：</h4>
                <div class="regex-wrapper mgb10"> <textarea cols="1000" id="regex_input" rows="3"
                                                            style="display: none;"
                                                            tabindex="1"></textarea></div>
                <h4>测试数据：</h4>
                <div class="str-wrapper"> <textarea cols="100" id="str_input" rows="10"
                                                    style="display: none;"
                                                    tabindex="2"></textarea></div>
                <h3 style="display: none">共找到 <var id="result_count">0</var> 处匹配结果</h3>
                <pre id="result_content" style="display: none"></pre>
                <h3>共找到 <var id="result_count2">0</var> 处分组结果</h3>
                <pre id="result_content2"></pre>
            </div>
        </div>
        <div class="project_location"><label>匹配项目所在位置</label>
            <div class="rule_content">
                <div class="rule_content2"><label for="account_name1">账户名称1</label><input
                        id="account_name1" placeholder="使用$1、$2这样进行占位" type="text"></div>
                <div class="rule_content2"><label for="account_name2">账户名称2</label><input
                        id="account_name2" placeholder="只有类型为转账与还款才需要" type="text"></div>
                <div class="rule_content2"><label for="type">收支类型</label><select id="type"
                                                                                 name="type">
                    <option selected value="0"> 支出</option>
                    <option value="1"> 收入</option>
                    <option value="2"> 转账</option>
                    <option value="3"> 信用还款</option>
                </select></div>
                <div class="rule_content2"><label for="money">金额</label><input id="money"
                                                                               placeholder="使用$1、$2这样进行占位"
                                                                               type="text"></div>
                <div class="rule_content2"><label for="fee">手续费</label><input id="fee"
                                                                              placeholder="使用$1、$2这样进行占位"
                                                                              type="text" value="0">
                </div>
                <div class="rule_content2"><label for="shopName">商户名称</label><input id="shopName"
                                                                                    placeholder="使用$1、$2这样进行占位"
                                                                                    type="text">
                </div>
                <div class="rule_content2"><label for="shopRemark">商户备注</label><input
                        id="shopRemark" placeholder="使用$1、$2这样进行占位" type="text"></div>
                <div class="rule_content2"><label for="time">时间</label><input id="time"
                                                                              placeholder="时间戳或者包含年月日的时间"
                                                                              type="text"></div>
            </div>
        </div>
        <div class="buttons">
            <button class="button1" id="test" name="测试">测试</button>
            <button id="save" name="保存">保存</button>
        </div>
    </form>
</div>
<div class="modal" id="tip">
    <div class="modal-content">
        <div class="modal-header"><span class="close cancel2">&times;</span><h4>测试结果</h4></div>
        <div class="modal-body"><p id="tip_content"></p></div>
        <div class="modal-footer">
            <div class="buttons">
                <button class="cancel2">确定</button>
            </div>
        </div>
    </div>
</div>
<script src="../Public/jquery/jquery.js"></script>
<script src="../Public/jquery/1.js"></script>
<script src="../Public/jquery/common.min.js"></script>
<script>
     function showTip(str){ $("#tip_content").html(str); $("#tip").css("display", "block"); } $(".cancel2").on("click", function (e) { $("#tip").css("display", "none"); }); function getType(jsArrElement) { if(jsArrElement==="0")return "支出"; if(jsArrElement==="1")return "收入"; if(jsArrElement==="2")return "转账"; if(jsArrElement==="3")return "信用还款"; return jsArrElement; } $("#test").on("click", function (e) { var js=getJs(); if(js==="") return; const jsData = getFunction($("#str_input").val(),js); console.log(jsData); try { const ret = eval(jsData); var jsArr=ret.split("|"); if(jsArr.length!==8){ Toast("奇怪了，好像有奇怪的东西混入了~",2000); return; } let str = ""; str+="账户名称1："+jsArr[1]+"<br>"; str+="账户名称2："+jsArr[4]+"<br>"; str+="收支类型："+getType(jsArr[2])+"<br>"; str+="金额："+jsArr[3]+"<br>"; str+="手续费："+jsArr[6]+"<br>"; str+="时间："+jsArr[7]+"<br>"; str+="商户名称："+jsArr[5]+"<br>"; str+="商户备注："+jsArr[0]+"<br>"; showTip(str); } catch (e) { console.log(jsData); showTip("自动识别执行出错：" + e+"<br>也许你应该检查一下你的正则表达式~<br>完整JS:%%%HTMLCOMPRESS~PRE&&&"); console.log(htmlspecialchars(jsData)); console.log(e) } }); $("#save").on("click", function (e) { window.AndroidJS.Save( getQueryVariable("id"),JSON.stringify(getData()),getQueryVariable("type") ); }); $("#result_count").bind("DOMNodeInserted",function(e){ var data = $("#regex_input").val(); var pattern = eval("/"+data+"/"); var str=""; var len=1; if(pattern.test($("#str_input").val())){ var array = pattern.exec($("#str_input").val()); len=array.length; for(var i=1;i<len;i++){ str+="<b>【$"+i+"】</b> "+array[i]+"<br>"; } } $("#result_count2").html((len-1).toString()); $("#result_content2").html(str); }); function setData(){ let data = decodeURIComponent(getQueryVariable("data")); if(data!==undefined){ let json1=JSON.parse(data); $("#sort_name").val(json1["name"]); $("#sort_remark").val(json1["des"]); $("#regex_input").html(json1["regular"]); $("#sort_package").val(json1["fromApp"]); $("#str_input").html(json1["text"]); let json2=json1["tableList"]; $("#account_name1").val(json2["account1"]); $("#account_name2").val(json2["account2"]); $("#type").val(json2["type"]); $("#money").val(json2["money"]); $("#fee").val(json2["fee"]); $("#time").val(json2["time"]); $("#shopName").val(json2["shopName"]); $("#shopRemark").val(json2["shopRemark"]); } } function getData() { let Json={}; Json["account1"]=$("#account_name1").val(); Json["account2"]=$("#account_name2").val(); Json["type"]=$("#type").val(); Json["time"]=$("#time").val(); Json["money"]=$("#money").val(); Json["fee"]=$("#fee").val(); Json["shopName"]=$("#shopName").val(); Json["shopRemark"]=$("#shopRemark").val(); let Json2={}; Json2["name"]=$("#sort_name").val(); Json2["text"]=$("#str_input").val(); Json2["regular"]=$("#regex_input").val(); Json2["fromApp"]=$("#sort_package").val(); Json2["des"]=$("#sort_remark").val(); Json2["identify"]=getQueryVariable("type"); Json2["tableList"]=Json; return Json2; } function getJs(){ var data = ";try{pattern=/%s/;if(pattern.test(a)){var array=pattern.exec(a);var remark='%s',account='%s',type='%s',money='%s',shopName='%s',account2='%s',fee='%s',time='%s';for(var i=1;i<array.length;i++){var rep=\"$\"+i.toString();var repStr=array[i];remark=remark.replace(rep,repStr);account=account.replace(rep,repStr);type=type.replace(rep,repStr);money=money.replace(rep,repStr);shopName=shopName.replace(rep,repStr);account2=account2.replace(rep,repStr);fee=fee.replace(rep,repStr);time=time.replace(rep,repStr)}return remark+'|'+account+'|'+type+'|'+money+'|'+account2+'|'+shopName+'|'+fee+\"|\"+time}}catch(e){console.log(e)};"; if ($("#sort_name").val() === "") { Toast("规则名称不能为空", 2000); return ""; } if ($("#regex_input").val() === "") { Toast("正则不能为空", 2000); return ""; } if ($("#str_input").val() === "") { Toast("测试文本不能为空", 2000); return ""; } var Json=getData(); var Json1=Json["tableList"]; data = String.format(data, Json["regular"], Json1["shopRemark"],Json1["account1"],Json1["type"],Json1["money"],Json1["shopName"],Json1["account2"],Json1["fee"],Json1["time"]); return data; } function getFunction( body, regex) { var js = ";function getData(a){a=(a.replace(/\\n/g,\"\\\\n\"));var b,account,type,money,shopName,account2,fee,time;%s return b+'|'+account+'|'+type+'|'+money+'|'+account2+'|'+shopName+'|'+fee+\"|\"+time};;getData('%s')"; return String.format(js, regex, StringAs(body)); } setData();
</script>
<script src="../Public/jquery/2.js"></script>
</body>
</html>